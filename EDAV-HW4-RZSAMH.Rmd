---
title: "Homework 4"
output:
  html_document: default
  html_notebook: default
---

  Team Members: Sanjmeet Abrol (sa3424), Molly Hanson (meh2243), Rachel Zhang (rhz2106)
  Team Name: RZSAMH
  
  **1.[10 points] Write a DRAFT introduction. (It will likely change by the time you submit the final project.)** 

*Why did we chose this topic?*

  After reviewing the USDA website and noticing that their reports were all textual with no vizualisations, we wanted to provided a supplementary perspective and more comprehensive view on the Food Atlas data set. Additionally, we wanted to use our new exploratory data analysis and visualization toolkit to validate the facts that are claimed in their reports. 
  
  On a more general note, we are interested in gaining a deeper understanding of food insecurity as it is broad and quite loosely defined. Our goal is to help provide a more concrete definition of food insecurity, leading to greater clarity. Under this goal, we seek to examine the differences between food insecurity and poverty, as well as the other variables included in this expansive data set.
  
*What questions are we interested in answering?* 

  As noted in the above section, we are interested in seeing in confirming the USDA's conclusions and statments they make on their site.  We plan to do this by observing trends across factors taht affect food insecurity, and assess the effectiveness of various programs that have been implemented to improve these issues. Through exploratory data analysis and presentation techiques, we seek to asses which variables do or do not relate to food insecurity.

*How did you find the data?*

While looking for interesting data sets, Rachel discovered this data set.  A couple features of the data set that stood out were US county level data for most of the variables and the same variables measured over different time lines.  Sanjmeet and Molly shared interest in this data set based on their interestes in social programs and sustanability. 

*Where can the reader find this data?*
  
  Both the data set and support documentation can be found [here](https://www.ers.usda.gov/data-products/food-environment-atlas/data-access-and-documentation-downloads/) on the Economic Research Service page of the United States Department of Agriculture site. We are using the Current Version of the data and documentation, last updated 8/19/2015 and 8/10/2015, respectively.  
  
  As the data set is an excel document with multiple sheets, during one of our first group meetings we outlined the key variables we wanted to analyze and grouped them all into one dataset.  Please see the attached file "data_cleaning.R" for this code. 

  **2. [10 points] Write a DRAFT description of the Team section.**
  
Collectively we've met throughout the semester discussing ideas and initial exploration. So far, we have divided features for exploration, connected with each other during bi-weekly meetings and our exploration and topic development has moved forward likewise.

  As we now have a sound focus and structure for our final project, we have divided up our work as follows:
   
* Sanjmeet is looking into the quality of data (missing data points, assessing differences in timeframes, variables calculated on a state-wide basis vs. county-level detail), and effectiveness of current programs to combat food insecurity in the US (SNAP, WIC)
* Rachel is focusing on comparing variables between high, low, and average food insecure states, as well as mapping county-level data 
* Molly is working on the overall narative, including visualizing state-wide variables to set the tone for the overall picture of US food insecurity, outside reserach into different variables and general commentary  

  **3. [30 points] Choose four variables that you consider to be important and begin analyzing them, following the advice in Chapter 8, sections 1 & 2, of Graphical Data Analysis with R, to begin by summarizing and plotting individual variables. Histograms and bar charts work well for this purpose, but you can use whatever techniques you find appropriate.**
  
  1. As our project focuses on Food Insecurity in the US, the first variable(s) we will begin to analyze are those related to **food insecurity**.  Note, the below code uses the cleaned data set as mentioned in question 1.  The variables considered here are the three-year average of household food insecurity (%), and very low food security (%). Both variables have been calculated for 2000-2002, 2007-2009 and 2010-2012. These are all state level variable and we have used both bar charts and heatmaps of the US to analyze these variables.
  
  
```{r}
library(tidyverse)
library(lubridate)
library(dplyr)
full_df <- read_csv('fea_02182017.csv')

#Summary DF by state - FOR MAPPING
state_data <- full_df %>% select(FIPS, State.x, County.x,PCT_SNAP09, PCT_SNAP14, PCH_SNAP_09_14, SNAP_PART_RATE08,SNAP_PART_RATE10,SNAP_OAPP00,SNAP_OAPP05,SNAP_OAPP10,SNAP_FACEWAIVER00,SNAP_FACEWAIVER05,SNAP_FACEWAIVER10,SNAP_VEHEXCL00,SNAP_VEHEXCL05,SNAP_VEHEXCL10,SNAP_BBCE00,SNAP_BBCE05,SNAP_BBCE10,SNAP_REPORTSIMPLE00,SNAP_REPORTSIMPLE05,SNAP_REPORTSIMPLE10,FOODINSEC_00_02,FOODINSEC_07_09,FOODINSEC_10_12,CH_FOODINSEC_02_12,CH_FOODINSEC_09_12,VLFOODSEC_00_02,VLFOODSEC_07_09,VLFOODSEC_10_12,CH_VLFOODSEC_02_12,CH_VLFOODSEC_09_12,FOODINSEC_CHILD_01_07,FOODINSEC_CHILD_03_11,FOOD_TAX11,PC_FFRSALES02,PC_FFRSALES07,PC_FSRSALES02,PC_FSRSALES07) %>% group_by(State.x) %>% summarise(
  "PCT_SNAP09"=mean(PCT_SNAP09, na.rm=TRUE),
  "PCT_SNAP14"=mean(PCT_SNAP14, na.rm=TRUE),
  "PCH_SNAP_09_14"=mean(PCH_SNAP_09_14, na.rm=TRUE),
  "SNAP_PART_RATE08"=mean(SNAP_PART_RATE08, na.rm=TRUE),
  "SNAP_PART_RATE10"=mean(SNAP_PART_RATE10, na.rm=TRUE),
  "SNAP_OAPP00"=mean(SNAP_OAPP00, na.rm=TRUE),
  "SNAP_OAPP05"=mean(SNAP_OAPP05, na.rm=TRUE),
  "SNAP_OAPP10"=mean(SNAP_OAPP10, na.rm=TRUE),
  "SNAP_FACEWAIVER00"=mean(SNAP_FACEWAIVER00, na.rm=TRUE),
  "SNAP_FACEWAIVER05"=mean(SNAP_FACEWAIVER05, na.rm=TRUE),
  "SNAP_FACEWAIVER10"=mean(SNAP_FACEWAIVER10, na.rm=TRUE),
  "SNAP_VEHEXCL00"=mean(SNAP_VEHEXCL00, na.rm=TRUE),
  "SNAP_VEHEXCL05"=mean(SNAP_VEHEXCL05, na.rm=TRUE),
  "SNAP_VEHEXCL10"=mean(SNAP_VEHEXCL10, na.rm=TRUE),
  "SNAP_BBCE00"=mean(SNAP_BBCE00, na.rm=TRUE),
  "SNAP_BBCE05"=mean(SNAP_BBCE05, na.rm=TRUE),
  "SNAP_BBCE10"=mean(SNAP_BBCE10, na.rm=TRUE),
  "SNAP_REPORTSIMPLE00"=mean(SNAP_REPORTSIMPLE00, na.rm=TRUE),
  "SNAP_REPORTSIMPLE05"=mean(SNAP_REPORTSIMPLE05, na.rm=TRUE),
  "SNAP_REPORTSIMPLE10"=mean(SNAP_REPORTSIMPLE10, na.rm=TRUE),
  "FOODINSEC_00_02"=mean(FOODINSEC_00_02, na.rm=TRUE),
  "FOODINSEC_07_09"=mean(FOODINSEC_07_09, na.rm=TRUE),
  "FOODINSEC_10_12"=mean(FOODINSEC_10_12, na.rm=TRUE),
  "CH_FOODINSEC_02_12"=mean(CH_FOODINSEC_02_12, na.rm=TRUE),
  "CH_FOODINSEC_09_12"=mean(CH_FOODINSEC_09_12, na.rm=TRUE),
  "VLFOODSEC_00_02"=mean(VLFOODSEC_00_02, na.rm=TRUE),
  "VLFOODSEC_07_09"=mean(VLFOODSEC_07_09, na.rm=TRUE),
  "VLFOODSEC_10_12"=mean(VLFOODSEC_10_12, na.rm=TRUE),
  "CH_VLFOODSEC_02_12"=mean(CH_VLFOODSEC_02_12, na.rm=TRUE),
  "CH_VLFOODSEC_09_12"=mean(CH_VLFOODSEC_09_12, na.rm=TRUE),
  "FOODINSEC_CHILD_01_07"=mean(FOODINSEC_CHILD_01_07, na.rm=TRUE),
  "FOODINSEC_CHILD_03_11"=mean(FOODINSEC_CHILD_03_11, na.rm=TRUE),
  "FOOD_TAX11"=mean(FOOD_TAX11, na.rm=TRUE),
  "PC_FFRSALES02"=mean(PC_FFRSALES02, na.rm=TRUE),
  "PC_FFRSALES07"=mean(PC_FFRSALES07, na.rm=TRUE),
  "PC_FSRSALES02"=mean(PCT_SNAP09, na.rm=TRUE),
  "PC_FSRSALES07"=mean(PC_FSRSALES07, na.rm=TRUE)
) %>% filter(State.x!="PR") %>% ungroup()

 ##### Code for drawing maps
library(ggmap)
library(RColorBrewer)

load_state_geo <- function() {
  # Bring in lat/long data by state name
  state_geo <- map_data("state")
  head(state_geo)
  # Bring in state names and abbreviations
  data(state)
  state_abbrevs <- tibble(abb = state.abb, region = tolower(state.name))
  # Merge to match state abbreviations with lat/long
  state_df <- full_join(state_geo, state_abbrevs, by = "region")
  return(state_df)
}

state_df <- load_state_geo()
state_feature <- full_join(state_df, state_data, by = c('abb' = 'State.x'))

## Insecurity over time - US Map
insec_data <- state_feature %>% select(lat, long, group, order, region, abb, FOODINSEC_00_02, FOODINSEC_07_09, FOODINSEC_10_12) %>% gather("Year","Value", -lat, -long, -group, -order, -region, -abb)

ggplot(insec_data, aes(x = long, y = lat, fill = Value, group = group)) + 
  geom_polygon(color = "white") +
  scale_fill_continuous(low = "#fee5d9", high = "#a50f15", guide="colorbar")+
  coord_fixed(1.3)+
  theme_bw() +
  facet_wrap(~Year) +
  ggtitle("Food Insecurity in USA (2000-2012)") +
  labs(x="",y="")

 ## Very Low Insecurity over time - US Map
vl_insec_data <- state_feature %>% select(lat, long, group, order, region, abb, VLFOODSEC_00_02, VLFOODSEC_07_09, VLFOODSEC_10_12) %>% gather("Year","Value", -lat, -long, -group, -order, -region, -abb)

ggplot(vl_insec_data, aes(x = long, y = lat, fill = Value, group = group)) + 
  geom_polygon(color = "white") +
  scale_fill_continuous(low = "#fee5d9", high = "#a50f15", guide="colorbar")+
  coord_fixed(1.3)+
  theme_bw() +
  facet_wrap(~Year) +
  ggtitle("Very Low Food Insecurity in USA (2000-2012)") +
  labs(x="",y="")

```
  
  Due to the inconsistent date ranges, the below graphs only include the 2007-2009 and 2010-2012 features. It was important to remove the 2000-2002 data from this comparision as it is not a linear comparision and the above graphs may lead readers to make false conclusions regarding the worsening of food insecurity in the US.  In the below graphs with only 2 time frames, we see increasing food insecurity in the South.
  
```{r}
## Insecurity over time - 07-09/10-12
insec_data_2 <- state_feature %>% select(lat, long, group, order, region, abb, FOODINSEC_07_09, FOODINSEC_10_12) %>% gather("Year","Value", -lat, -long, -group, -order, -region, -abb)

ggplot(insec_data_2, aes(x = long, y = lat, fill = Value, group = group)) + 
  geom_polygon(color = "white") +
  scale_fill_continuous(low = "#fee5d9", high = "#a50f15", guide="colorbar")+
  coord_fixed(1.3)+
  theme_bw() +
  facet_wrap(~Year) +
  ggtitle("Food Insecurity in USA (2007-09 vs. 2010-12)") +
  labs(x="",y="")

 ## Very Low Insecurity over time - 07-09/10-12
vl_insec_data_2 <- state_feature %>% select(lat, long, group, order, region, abb, VLFOODSEC_07_09, VLFOODSEC_10_12) %>% gather("Year","Value", -lat, -long, -group, -order, -region, -abb)

ggplot(vl_insec_data_2, aes(x = long, y = lat, fill = Value, group = group)) + 
  geom_polygon(color = "white") +
  scale_fill_continuous(low = "#fee5d9", high = "#a50f15", guide="colorbar")+
  coord_fixed(1.3)+
  theme_bw() +
  facet_wrap(~Year) +
  ggtitle("Very Low Food Insecurity in USA (2007-09 vs. 2010-12)") +
  labs(x="",y="")
```
  
  The below bar charts explore the variables FOODINSEC_07_09 and FOODINSEC_10_12 by state. Here we see the range of % of households experiencing food insecurity is increasing: from 07-09 the range was 6.7-17.7%, whereas from 10-12 the range was 8.7.20.9%. 
  

```{r}
insec_bar <- state_data %>% select(State.x, FOODINSEC_07_09, FOODINSEC_10_12) 

ggplot(insec_bar, aes(x=reorder(State.x,FOODINSEC_07_09), y=FOODINSEC_07_09)) + 
  geom_col() + 
  coord_flip() +
  labs(x="State", y="Household food insecurity (%, 3-year avg)") +
  ggtitle("Household food insecurity by state (%, 3-year avg) - 2007-2009")

ggplot(insec_bar, aes(x=reorder(State.x,FOODINSEC_10_12), y=FOODINSEC_10_12)) + 
  geom_col() + 
  coord_flip() +
  labs(x="State", y="Household food insecurity (%, 3-year avg)") +
  ggtitle("Household food insecurity by state (%, 3-year avg) - 2010-2012")

```
  
2. Our inital thought was that food insecurity was related to **low access** to food.
  
3. Since one of our objectives it to assess the effectiveness of the current programs to help improve food insecurity issues, we explored some of the **SNAP related variables**. First we used a bar chart to look at the each state's rank by percentage change in SNAP participation. Interestingly, ND was the only state that saw a decrease in SNAP participation over this timeframe.

  As we also have information on SNAP participants as a percentage of eligible participants within a state, we also plotted this to observe differences in ranking. One observation is that FL is tied for the highest rank in percent change in SNAP participation, however when looking at SNAP participation as a percent of the elible population, FL is among the lowest participation rates. 
  
  In our final report, we plan to look into documentation and articles about the SNAP program, to highlight differences (if any) between states.  
  

```{r}

df_SNAP_statevar<-select(full_df,FIPS,State.x,County.x,PCH_SNAP_09_14,SNAP_PART_RATE08,SNAP_PART_RATE10)

df_SNAP_statevar <- df_SNAP_statevar[complete.cases(df_SNAP_statevar),]

df_SNAP_state <- df_SNAP_statevar %>%   
  group_by(State.x) %>%
  summarise(PCH_SNAP_09_14=min(PCH_SNAP_09_14),SNAP_PART_RATE08=min(SNAP_PART_RATE08),
            SNAP_PART_RATE10=min(SNAP_PART_RATE10))

ggplot(df_SNAP_state,aes(x=reorder(State.x,+PCH_SNAP_09_14),y=df_SNAP_state$PCH_SNAP_09_14)) + 
  geom_bar(stat="identity",color="black",fill="thistle") + 
  coord_flip() + 
  ylab("%change in avg monthly population receiving SNAP benefits [2008-12]") + 
  xlab("State") + 
  ggtitle("State Rankings by percent change in SNAP participation (2008 to 2012)")


ggplot(df_SNAP_state,aes(x=reorder(State.x,+df_SNAP_state$SNAP_PART_RATE08),y=df_SNAP_state$SNAP_PART_RATE08)) + 
  geom_bar(stat="identity",color="black",fill="lightblue") + 
  coord_flip() + 
  ylab("SNAP participants (% eligible pop), 2008") + 
  xlab("State") + 
  ggtitle("State Rankings by SNAP participation as a percentage of eligible population")
```
  
  
4. **Median Income** was another variable we wanted to explore

